---
import { PageLayout } from "uc-theme/components";
import { getCollection } from "astro:content";

export const prerender = true;

export async function getStaticPaths() {
  const POSTS_PER_PAGE = 10;
  const posts = await getCollection("blog");
  const totalPages = Math.ceil(posts.length / POSTS_PER_PAGE);
  return Array.from({ length: totalPages }, (_, i) => ({
    params: { page: (i + 1).toString() },
  }));
}

const { page } = Astro.params;
const currentPage = parseInt(page);
const POSTS_PER_PAGE = 10;
const posts = await getCollection("blog");
const start = (currentPage - 1) * POSTS_PER_PAGE;
const end = start + POSTS_PER_PAGE;
const paginatedPosts = posts.slice(start, end);
---

<PageLayout title={`Blog - Page ${page}`}>
  <div class="blog-hero">
    <h1>Blog</h1>
    <p>The first multimodal open catalog for data and AI</p>
    <h2>Page {page}</h2>
    <div class="blog-posts">
      {
        paginatedPosts.map((post) => (
          <article>
            <h3>{post.data.title}</h3>
            <p>{post.data.description}</p>
          </article>
        ))
      }
    </div>
  </div>
</PageLayout>
