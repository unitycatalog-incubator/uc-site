---
import { getCollection, render, getEntries } from "astro:content";
import { BlogPost, PageLayout } from "uc-theme/components";
import { getBlogPublishedAt } from "uc-theme/blog";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => {
    const publishedAt = getBlogPublishedAt(post);
    return {
      params: { id: post.id },
      props: { post, publishedAt },
    };
  });
}

const { post } = Astro.props;
const authors = await getEntries(post.data.authors);
const { Content } = await render(post);

const raw = typeof post.body === "string" ? post.body : "";
---

<PageLayout title={post.data.title} description={post.data.description}>
  <BlogPost
    title={post.data.title}
    authors={authors.map((author) => ({
      name: author.data.name,
      ...(author.data.title && { title: author.data.title }),
      ...(author.data.image && { image: author.data.image }),
    }))}
    thumbnail={post.data.thumbnail}
    raw={raw}
    postId={post.id}
  >
    <!-- Hidden searchable content for better indexing -->
    <div style="display: none;" data-pagefind-body>
      {post.data.title}
      {post.data.description}
      {raw}
    </div>
    <Content />
  </BlogPost>
</PageLayout>
